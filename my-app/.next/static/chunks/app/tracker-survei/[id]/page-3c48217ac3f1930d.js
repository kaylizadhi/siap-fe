(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5116],{8133:function(a,e,t){Promise.resolve().then(t.bind(t,5888))},5888:function(a,e,t){"use strict";t.r(e),t.d(e,{default:function(){return d}});var n=t(7437),s=t(778),i=t.n(s),l=t(2265),u=t(7409);t(2648);var r=t(9376),o=a=>{let{label:e,status:t,onStatusChange:s,fieldKey:i,isLoading:l,isEditable:r,className:o=""}=a;return(0,n.jsxs)("div",{className:"w-full text-xs mb-2 ".concat(o),children:[(0,n.jsx)("div",{className:"text-xs font-medium mb-1",title:e,children:e}),(0,n.jsx)("div",{className:"border rounded-md p-2 ".concat({NOT_STARTED:"bg-gray-200",IN_PROGRESS:"bg-yellow-200",FINISHED:"bg-green-200",DELAYED:"bg-red-200"}[t]," ").concat(l?"opacity-50":""),children:(0,n.jsx)("select",{value:t,onChange:a=>{let e=a.target.value;r?s(i,e):u.Am.error("You don't have permission to update this status")},disabled:l||!r,className:"w-full bg-transparent border-none focus:ring-0 ".concat(r?"cursor-pointer":"cursor-not-allowed"," text-xs"),"aria-label":"Update status for ".concat(e),children:Object.entries({NOT_STARTED:"Not Started",IN_PROGRESS:"In Progress",FINISHED:"Finished",DELAYED:"Delayed"}).map(a=>{let[e,t]=a;return(0,n.jsx)("option",{value:e,children:t},e)})})})]})};function d(a){let{params:e}=a,{id:t}=e,s=(0,r.useRouter)(),[d,c]=(0,l.useState)(null),[p,_]=(0,l.useState)(!0),[b,m]=(0,l.useState)(null),[h,g]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{let a=localStorage.getItem("authToken");if(!a){s.push("/login");return}try{let e=(await Promise.all([{url:"".concat("https://siap-be-production.up.railway.app/api/","accounts/check_role_administrasi/"),role:"Administrasi"},{url:"".concat("https://siap-be-production.up.railway.app/api/","accounts/check_role_logistik/"),role:"Logistik"},{url:"".concat("https://siap-be-production.up.railway.app/api/","accounts/check_role_pengendalimutu/"),role:"Pengendali Mutu"},{url:"".concat("https://siap-be-production.up.railway.app/api/","accounts/check_role_eksekutif/"),role:"Eksekutif"}].map(e=>fetch(e.url,{headers:{Authorization:"Token ".concat(a)}}).then(a=>({ok:a.ok,role:e.role}))))).find(a=>a.ok);if(e){g(e.role);return}s.push("/login")}catch(a){console.error("Failed to verify role:",a),s.push("/login")}})(),t&&v()},[t,s]);let v=async()=>{let a=localStorage.getItem("authToken");try{let e=await fetch("".concat("https://siap-be-production.up.railway.app/api/","survei-status/").concat(t,"/"),{headers:{Authorization:"Token ".concat(a)}});if(!e.ok)throw Error("Failed to fetch survey data");let n=await e.json(),s=n.status.reduce((a,e)=>{let[t,n]=Object.entries(e)[0];return a[t]=n,a},{});c({...n,status:s})}catch(a){u.Am.error("Failed to load survey data. Please try again.")}finally{_(!1)}},f=async(a,e)=>{let n;let s=localStorage.getItem("authToken");m(a),["buat_kontrak","buat_invoice_dp","pembayaran_dp","pembuatan_kwitansi_dp"].includes(a)?n="".concat("https://siap-be-production.up.railway.app/api/","survei-status/").concat(t,"/administrasi-awal/"):["terima_request_souvenir","ambil_souvenir"].includes(a)?n="".concat("https://siap-be-production.up.railway.app/api/","survei-status/").concat(t,"/logistik/"):["terima_info_survei","lakukan_survei","pantau_responden","pantau_data_cleaning"].includes(a)?n="".concat("https://siap-be-production.up.railway.app/api/","survei-status/").concat(t,"/pengendali-mutu/"):["pembuatan_laporan","buat_invoice_final","pembayaran_lunas","pembuatan_kwitansi_final","penyerahan_laporan"].includes(a)&&(n="".concat("https://siap-be-production.up.railway.app/api/","survei-status/").concat(t,"/administrasi-akhir/"));try{let t=await fetch(n,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Token ".concat(s)},body:JSON.stringify({[a]:e})});if(!t.ok){var i;let a=await t.json(),e=(null===(i=a.__all__)||void 0===i?void 0:i[0])||"Failed to update status";throw Error(e)}c(t=>({...t,status:{...t.status,[a]:e}})),u.Am.success("Status updated successfully")}catch(a){u.Am.error(a.message||"Failed to update status. Please try again."),v()}finally{m(null)}},y=a=>{var e;return(null===(e=({Administrasi:["buat_kontrak","buat_invoice_dp","pembayaran_dp","pembuatan_kwitansi_dp","pembuatan_laporan","buat_invoice_final","pembayaran_lunas","pembuatan_kwitansi_final","penyerahan_laporan"],Logistik:["terima_request_souvenir","ambil_souvenir"],"Pengendali Mutu":["terima_info_survei","lakukan_survei","pantau_responden","pantau_data_cleaning"],Eksekutif:[]})[h])||void 0===e?void 0:e.includes(a))||!1};return p||!d?(0,n.jsx)("div",{className:"p-6 max-w-7xl mx-auto",children:(0,n.jsxs)("div",{className:"animate-pulse",children:[(0,n.jsx)("div",{className:"h-20 bg-gray-200 rounded-lg mb-6"}),(0,n.jsx)("div",{className:"space-y-8",children:[1,2,3,4].map(a=>(0,n.jsx)("div",{className:"h-48 bg-gray-200 rounded-lg"},a))})]})}):(0,n.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,n.jsxs)("div",{className:"border-b border-gray-300 pb-4 mb-6",children:[(0,n.jsx)("h2",{className:"text-4xl font-bold mb-6 text-primary-900 ".concat(i().className),children:"Tracker Status"}),(0,n.jsx)("div",{className:"mt-2 text-lg ".concat(i().className),children:d.nama_survei}),(0,n.jsx)("div",{className:"text-gray-600 ".concat(i().className),children:d.nama_klien})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-lg mb-4",children:"Administrasi Awal"}),(0,n.jsx)(o,{label:"Buat Kontrak",status:d.status.buat_kontrak,onStatusChange:f,fieldKey:"buat_kontrak",isLoading:"buat_kontrak"===b,isEditable:y("buat_kontrak")}),(0,n.jsx)(o,{label:"Buat Invoice DP",status:d.status.buat_invoice_dp,onStatusChange:f,fieldKey:"buat_invoice_dp",isLoading:"buat_invoice_dp"===b,isEditable:y("buat_invoice_dp")}),(0,n.jsx)(o,{label:"Pembayaran DP",status:d.status.pembayaran_dp,onStatusChange:f,fieldKey:"pembayaran_dp",isLoading:"pembayaran_dp"===b,isEditable:y("pembayaran_dp")}),(0,n.jsx)(o,{label:"Pembuatan Kwitansi DP",status:d.status.pembuatan_kwitansi_dp,onStatusChange:f,fieldKey:"pembuatan_kwitansi_dp",isLoading:"pembuatan_kwitansi_dp"===b,isEditable:y("pembuatan_kwitansi_dp")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-lg mb-4",children:"Logistik"}),(0,n.jsx)(o,{label:"Menerima request souvenir",status:d.status.terima_request_souvenir,onStatusChange:f,fieldKey:"terima_request_souvenir",isLoading:"terima_request_souvenir"===b,isEditable:y("terima_request_souvenir")}),(0,n.jsx)(o,{label:"Mengambil souvenir",status:d.status.ambil_souvenir,onStatusChange:f,fieldKey:"ambil_souvenir",isLoading:"ambil_souvenir"===b,isEditable:y("ambil_souvenir")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-lg mb-4",children:"Pengendali Mutu"}),(0,n.jsx)(o,{label:"Menerima informasi survei",status:d.status.terima_info_survei,onStatusChange:f,fieldKey:"terima_info_survei",isLoading:"terima_info_survei"===b,isEditable:y("terima_info_survei")}),(0,n.jsx)(o,{label:"Melakukan survei",status:d.status.lakukan_survei,onStatusChange:f,fieldKey:"lakukan_survei",isLoading:"lakukan_survei"===b,isEditable:y("lakukan_survei")}),(0,n.jsx)(o,{label:"Memantau responden",status:d.status.pantau_responden,onStatusChange:f,fieldKey:"pantau_responden",isLoading:"pantau_responden"===b,isEditable:y("pantau_responden")}),(0,n.jsx)(o,{label:"Memantau data cleaning",status:d.status.pantau_data_cleaning,onStatusChange:f,fieldKey:"pantau_data_cleaning",isLoading:"pantau_data_cleaning"===b,isEditable:y("pantau_data_cleaning")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-lg mb-4",children:"Administrasi Akhir"}),(0,n.jsx)(o,{label:"Pembuatan Laporan",status:d.status.pembuatan_laporan,onStatusChange:f,fieldKey:"pembuatan_laporan",isLoading:"pembuatan_laporan"===b,isEditable:y("pembuatan_laporan")}),(0,n.jsx)(o,{label:"Buat Invoice Final",status:d.status.buat_invoice_final,onStatusChange:f,fieldKey:"buat_invoice_final",isLoading:"buat_invoice_final"===b,isEditable:y("buat_invoice_final")}),(0,n.jsx)(o,{label:"Pembayaran Lunas",status:d.status.pembayaran_lunas,onStatusChange:f,fieldKey:"pembayaran_lunas",isLoading:"pembayaran_lunas"===b,isEditable:y("pembayaran_lunas")}),(0,n.jsx)(o,{label:"Pembuatan Kwitansi Final",status:d.status.pembuatan_kwitansi_final,onStatusChange:f,fieldKey:"pembuatan_kwitansi_final",isLoading:"pembuatan_kwitansi_final"===b,isEditable:y("pembuatan_kwitansi_final")}),(0,n.jsx)(o,{label:"Penyerahan Laporan",status:d.status.penyerahan_laporan,onStatusChange:f,fieldKey:"penyerahan_laporan",isLoading:"penyerahan_laporan"===b,isEditable:y("penyerahan_laporan")})]})]})]})}},2648:function(){},778:function(a){a.exports={style:{fontFamily:"'__Caudex_ebaa45', '__Caudex_Fallback_ebaa45'",fontWeight:700,fontStyle:"normal"},className:"__className_ebaa45"}}},function(a){a.O(0,[5676,9419,8304,2971,2117,1744],function(){return a(a.s=8133)}),_N_E=a.O()}]);